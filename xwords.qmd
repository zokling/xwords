---
title: "xwords"
format: html
editor: source
---

```{r}
library(tidyverse)
library(glue)
```

```{r}
xwords <- read.csv("xwstats.csv")

xwords <- xwords |>
  mutate(puzzle_date = as.Date(puzzle_date),
         completed_at = as_datetime(completed_at_et),
         time_taken_m = time_taken/60,
         day_of_week = factor(day_of_week, 
                             levels = c("Sunday", "Monday", 
                                        "Tuesday", "Wednesday", 
                                        "Thursday", "Friday", 
                                        "Saturday"), 
                             ordered = T)
  ) |>
  select(-completed_at_et, -solved)
  
# manage outliers
xwords$time_taken_m[xwords$time_taken_m > 120] <- NA


head(xwords)
```

### exploration

date range

```{r}
range(xwords$puzzle_date)
range(xwords$completed_at)
```

### time taken

```{r}
xwords |>
  ggplot(aes(x = time_taken_m)) +
  geom_histogram()
```

crazy outliers

```{r}
xwords |>
  filter(time_taken_m > 60)

```

```{r}
  xwords |>
  ggplot(aes(x = time_taken_m)) +
  geom_histogram()
```

```{r}
xwords |>
  filter(day_of_week != "Sunday") |>  # remove sundays
  ggplot(aes(x = time_taken_m)) +
  geom_histogram(aes(fill = day_of_week)) +
  facet_wrap(~day_of_week) +
  theme_bw()
```

percentages with density plot

```{r}
xwords |>
  filter(day_of_week != "Sunday") |>  # remove outlier. remove sundays
  ggplot(aes(x = time_taken_m)) +
  geom_density(aes(fill = day_of_week)) +
  facet_wrap(~day_of_week) +
  labs(title = "") +
  theme_bw()
```

histo overall

```{r}
mindate <- as.Date(min(xwords$completed_at)) #earliest completion date
maxdate <- as.Date(max(xwords$completed_at)) #latest completion date

xwords |>
  filter(!(time_taken_m > 60) & day_of_week != "Su") |>  # remove outlier. remove sundays
  ggplot(aes(x = time_taken_m)) +
  geom_histogram(aes(fill = day_of_week)) +
  labs(title = "Distribution of NYT Xword Puzzle Solve Times", 
       subtitle = glue("Puzzles solved between {mindate} and {maxdate}"), 
       x = "Solve time in minutes",
       y = "Count", 
       fill = "Puzzle day of week") +
  theme_light()

ggsave("xword_solve_times_hist.jpeg", width = 9, height = 5, units = "in")

```

split by days with density plot

```{r}
xwords |>
  filter(!(time_taken_m > 600) & day_of_week != "Sunday") |>  # remove outlier. remove sundays
  ggplot(aes(x = time_taken_m)) +
  geom_density(aes(fill = day_of_week)) +
  labs(title = "Distribution of NYT Xword Puzzle Solve Times", 
       subtitle = glue("Puzzles solved between {mindate} and {maxdate}"), 
       x = "Solve time in minutes",
       y = "Density",
       fill = "Puzzle day of week") +
  theme_light()

ggsave("xword_solve_times_dist.jpeg", width = 9, height = 5, units = "in")
```

median

```{r}
xwords |>
  group_by(day_of_week) |>
  summarize(median_solvetime = median(time_taken_m, na.rm = T),
            mean_solvetime = mean(time_taken_m, na.rm = T))
```
looking surprisingly symmetrical

### puzzle solving speeds over time

have gone down...

```{r}
xwords |>
  filter(!(time_taken_m > 600) & day_of_week != "Sunday") |>
  ggplot(aes(x = as.Date(completed_at), y = time_taken_m)) +
  geom_point() +
  geom_smooth(se = F, method = "lm") +
  labs(subtitle = "date completed vs. time taken")
```

```{r}
xwords <- xwords |>
  mutate(completed_daysfromstart = as.Date(completed_at) - as.Date(min(completed_at)))

lm <- lm(time_taken_m ~ completed_daysfromstart, data = xwords)
lm
```

for every additional day i spend about half a second less on average

but maybe only because i'm doing more mondays

```{r}
xwords |>
  filter(!(time_taken_m > 600) & day_of_week != "Sunday") |>
  ggplot(aes(x = as.Date(completed_at), y = time_taken_m, color = day_of_week)) +
  geom_point() +
  geom_smooth(se = F, method = "lm") +
  labs(subtitle = "date completed vs. time taken")
```

```{r}
xwords |>
  filter(!(time_taken_m > 600) & day_of_week != "Sunday" & 
           as.Date(completed_at) >= ymd("2024-11-01")) |>
  ggplot(aes(x = as.Date(completed_at), y = time_taken_m, color = day_of_week)) +
  geom_line(linewidth = 1) 
```

by publishing date

```{r}
xwords |>
  filter(!(time_taken_m > 600) & day_of_week != "Sunday") |>
  ggplot(aes(x = puzzle_date, y = time_taken_m, color = day_of_week)) +
  geom_point() +
  labs(subtitle = "date of publication vs. time taken")


```

### how many puzzles was i doing over time?

```{r}
annots <- tibble(
  label = c("Final semester\nof graduate school","Marriage and\nhoneymoon",
            "Seasonal\ndepression"),
  xmin = c(ymd("2024-01-20"), ymd("2024-07-20"), ymd("2024-11-01")),
  xmax = c(ymd("2024-05-15"), ymd("2024-08-01"), ymd("2025-01-30"))
)

xwords |>
  ggplot(aes(x = as.Date(completed_at), fill = day_of_week)) +
  annotate("rect", xmin = annots$xmin[1:3],
           xmax = annots$xmax[1:3],
           ymin = 0, ymax = 24,
           alpha = 0.5, fill = "grey") +
  annotate("text", label = annots$label[1:3], 
           x = annots$xmin[1:3],
           y = 23,
           color = "grey30",
           size = 3, 
           hjust = 0) +
  geom_histogram(binwidth = 7) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b %G") +
  labs(title = "NYT Xword Puzzles Solved Over Time", 
       subtitle = glue("Puzzles solved between {mindate} and {maxdate}"),
       x = "Date completed",
       y = "Puzzles completed in a seven-day period",
       fill = "Day of puzzle") +
  theme_light()

ggsave("xword_solve_over_time.jpeg", width = 9, height = 5, units = "in")
```

```{r}

countbyweek <- xwords |>
  mutate(week_completed = week(completed_at) + 
           52*(year(completed_at)- min(year(completed_at)))) |>
  count(week_completed)

dfcounts <- data.frame(week_completed = min(countbyweek$week_completed):max(countbyweek$week_completed))

countbyweek <- dfcounts |>
  left_join(countbyweek, by = "week_completed") |>
  mutate(n = if_else(is.na(n), 0, n))

ggplot(countbyweek, aes(x = week_completed, y = n)) +
  geom_line() +
  geom_point()

```
